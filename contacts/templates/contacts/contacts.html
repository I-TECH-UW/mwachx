{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}Contacts{% endblock %}

{% block content %}
{% include 'modals/add-new-visit-modal.html' %}
    {% if contacts %}
    
     <div id='contacts-header'>
        <div id='contacts-search-group' class='col-md-3 input-group'>
            <span id='contact-search-icon' class='input-group-addon'><i class='mw mw-search'></i></span>
            <input type='text' id='contact-search' class='form-control' placeholder='name, anc, or study ID'>
        </div>
        <!--- ToDo: Add fliters back in 
        <ul class='filter-icons'>
            <li id='two-way-filter' class='active'>{% include 'icons/two-way.html' %}</li>
            <li id='one-way-filter'>{% include 'icons/one-way.html' %}</li>
            <li id='control-filter'>{% include 'icons/control.html' %}</li>
            <li id='pending-filter'>{% include 'icons/pending.html' %}</li>
        </ul>
        -->
    </div>
    
    
    <table id='contacts-table' class='table table-striped table-hover table-condensed'>
        <thead><tr>
            <th></th>
            <th>ID</th>
            <th>ANC #</th>
            <th>Nickname</th>
            <th>Study Group</th>
            <th>Status</th>
            <th>Number</th>
            <th>Weeks</th>
            <th>Sent</th>
            <th>Received</th>
        </tr></thead>
        <tbody>
    {% for contact in contacts %}
        <tr class='link-row contact' data-target='/contact/{{contact.study_id}}' 
            data-search-str='{{contact.study_id}}_{{contact.nickname}}_{{contact.anc_num}}_{{contact.phone_number}}'>
            <td><a href='{% url "contacts.views.contact" contact.study_id %}' class="btn {% if contact.status == 'post' %}btn-primary{% else %}btn-info{% endif %}" data-toggle="tooltip" data-title="View {{contact.nickname}}'s page">
                        <i class="mw {% if contact.status == 'post' %}mw-mwach-baby-phone{% else %}mw-mwach-phone{% endif %} mw-2x"></i>
                        </a></td>
            <td>{{contact.study_id|stringformat:'03i'}}</td>
            <td>{{contact.anc_num}}</td>
            <td>{{contact.nickname}}</td>
            <td>{{contact.study_group}}</td>
            <td>{{contact.status}}</td>
            <td>{{contact.phone_number}}</td>
            <td>{{contact.weeks}}</td>
            <td>{{contact.messages_sent}}</td>
            <td>{{contact.messages_received}}</td>
        </tr>
        </a>
    {% endfor %}
    </tbody>
    {% endif %}
    
<script language='javascript'>
    $(function(){
       $('.link-row').click(
            function(e) {
                // Only propogate if it is not a button
                if(! $(e.target).hasClass('btn') &&
                ! $(e.target).hasClass('tooltip-icon') &&
                ! $(e.target).hasClass('fa') ) {
                    window.location=$(this).data('target');
                }
            }); 
    });
</script>

<script src='{% static "js/contact_list.js" %}'></script>
{% endblock %}
